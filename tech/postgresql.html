<!DOCTYPE html>
<html lang="en-US">
  
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PostgreSQL cheatsheet | Isayah Young Burke</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Useful cheatsheet for Postgres">
    
    <link rel="preload" href="../assets/css/styles.css" as="style"><link rel="preload" href="../assets/js/app.js" as="script"><link rel="preload" href="../assets/js/vendor.js" as="script"><link rel="preload" href="https://zaylegend.com/assets/js/83.e722bf65.js" as="script"><link rel="prefetch" href="https://zaylegend.com/assets/js/10.ecb4aeeb.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/11.1cca5831.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/12.7b79cca9.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/13.dd35798e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/14.216f2375.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/15.76312eb5.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/16.46ae3a41.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/17.f7b08d61.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/18.dd33750e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/19.f64a7265.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/20.babf360f.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/21.e2503054.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/22.17537c93.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/23.79b2ac99.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/24.b97db607.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/25.a9e8a358.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/26.8e08adc5.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/27.edd2f913.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/28.691f6bf9.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/29.49c3431f.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/3.450f35a3.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/30.a232bb82.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/31.8c696542.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/32.c9fa23f8.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/33.8d8f26d6.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/34.9b0240fb.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/35.57f7fff7.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/36.007b0846.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/37.4712a913.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/38.047ae1e6.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/39.b70787ca.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/4.55c6a11e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/40.e56466c4.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/41.26e2630e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/42.ebfc62d1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/43.3c2d7a5e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/44.392fcaba.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/45.039d9812.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/46.db45e55e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/47.96f5c16a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/48.f022a16f.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/49.fc458b57.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/5.3e80985b.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/50.a9d9b467.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/51.7af4f65a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/52.5de2b44d.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/53.39742fa8.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/54.fd653217.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/55.065024be.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/56.aeb89b2a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/57.5a859f32.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/58.74831ded.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/59.f96dffab.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/6.2a6dbaf7.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/60.950b04ed.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/61.fc7c628c.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/62.01f29eea.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/63.24b3adfd.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/64.dfcf9b15.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/65.e197b51a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/66.fadde5b0.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/67.d9d7cbaf.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/68.e3304da2.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/69.57965b45.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/7.d1aa2f1c.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/70.bf37e9a8.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/71.fdd554eb.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/72.8c427b8c.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/73.f739c7ae.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/74.d2305510.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/75.9dd7a327.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/76.cf0b2767.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/77.4c395fa6.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/78.def79530.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/79.2ae40e11.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/8.9fa57ec5.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/80.7c36c3a1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/81.12abf8da.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/82.3da8caa4.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/84.8d2883f1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/85.28f50940.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/86.70601b86.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/87.d07525a0.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/88.f8e0b95a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/89.f3b11bd0.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/9.fe7ded09.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/90.a85b4b17.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/91.bb030ac1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/92.458c9816.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/93.ef320c02.js">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/custom.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="https://zaylegend.com/" class="home-link router-link-active"><!----> <span class="site-name">Isayah Young Burke</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://zaylegend.com/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="../index.html" class="nav-link router-link-active">
  Knowledge
</a></div><div class="nav-item"><a href="https://zaylegend.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Subscribe
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/zaylegend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://zaylegend.com/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="../index.html" class="nav-link router-link-active">
  Knowledge
</a></div><div class="nav-item"><a href="https://zaylegend.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Subscribe
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/zaylegend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../chess.html'>Chess</a></li><li><a class='sidebar-link' href='../climbing.html'>Climbing</a></li><li><a class='sidebar-link' href='../consciousness.html'>Consciousness</a></li><li><a class='sidebar-link' href='../languages.html'>Languages</a></li><li><a class='sidebar-link' href='../mathematics.html'>Mathematics</a></li><li><a class='sidebar-link' href='../meditation.html'>Meditation</a></li><li><a class='sidebar-link' href='../mimetic-theory.html'>Mimetic Theory</a></li><li><a class='sidebar-link' href='../music.html'>Music</a></li><li><a class='sidebar-link' href='../physics.html'>Physics</a></li><li><a class='sidebar-link' href='../public-speaking.html'>Public Speaking</a></li><li><a class='sidebar-link' href='../pyrolysis.html'>Pyrolysis</a></li><li><a class='sidebar-link' href='../relationships.html'>Relationships</a></li><li><a class='sidebar-link' href='../soil.html'>Soil Health</a></li><li><a class='sidebar-link' href='../space.html'>Space</a></li><li><a class='sidebar-link' href='../trees.html'>Trees</a></li><li><a class='sidebar-link' href='../writing.html'>Writing</a></li><li><a class='sidebar-link' href='../zoology.html'>Zoology</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tech</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='awesome-list.html'>Awesome List</a></li><li><a class='sidebar-link' href='bash-profile.html'>MacOS Bash Profile</a></li><li><a class='sidebar-link' href='docker.html'>Docker Cheatsheet</a></li><li><a class='sidebar-link' href='html-cheatsheet.html'>HTML Cheatsheet</a></li><li><a class='sidebar-link' href='macos-tips.html'>MacOS tips</a></li><li><a class='sidebar-link' href='mental-models.html'>Mental Models</a></li><li><a aria-current='page' class='active sidebar-link' href='postgresql.html'>PostgreSQL cheatsheet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a class='sidebar-link' href='postgresql.html#upgrading'>Upgrading</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='postgresql.html#testing'>Testing</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='postgresql.html#templates'>Templates</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='postgresql.html#utilities'>Utilities</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='postgresql.html#using-dblink-in-postgres'>Using dblink in Postgres</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='postgresql.html#postgres-resources'>Postgres Resources</a></li></ul></li><li><a class='sidebar-link' href='postgres-data.html'>Loading JSON into Postgres</a></li><li><a class='sidebar-link' href='regex.html'>Regex Cheatsheet</a></li><li><a class='sidebar-link' href='secrets-management-sops.html'>Secrets management - SOPS</a></li><li><a class='sidebar-link' href='seo.html'>SEO Cheatsheet</a></li><li><a class='sidebar-link' href='today-i-learned.html'>Today I Learned</a></li><li><a class='sidebar-link' href='vscode-snippets.html'>VSCode Snippets</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Business</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../business/hiring.html'>Hiring</a></li><li><a class='sidebar-link' href='../business/management.html'>Management</a></li><li><a class='sidebar-link' href='../business/sales.html'>Sales</a></li><li><a class='sidebar-link' href='../business/marketing.html'>Marketing</a></li><li><a class='sidebar-link' href='../business/fundraising.html'>Fundraising</a></li><li><a class='sidebar-link' href='../business/resources.html'>Startup Resources</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Levels</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../levels/business.html'>Business</a></li><li><a class='sidebar-link' href='../levels/life.html'>Life</a></li><li><a class='sidebar-link' href='../levels/leadership.html'>Leadership</a></li><li><a class='sidebar-link' href='../levels/learning.html'>Learning</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Philosophy</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../philosophy/ethics.html'>Ethics</a></li><li><a class='sidebar-link' href='../philosophy/buddhism.html'>Buddhism</a></li><li><a class='sidebar-link' href='../philosophy/stoicism.html'>Stoicism</a></li><li><a class='sidebar-link' href='../philosophy/desire.html'>Desire</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>People</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../people.html'>People</a></li><li><a class='sidebar-link' href='../people/lee-kuan-yew.html'>Lee Kuan Yew</a></li><li><a class='sidebar-link' href='../people/jensen-huang.html'>Jensen Huang</a></li><li><a class='sidebar-link' href='../people/elon-musk.html'>Elon Musk</a></li><li><a class='sidebar-link' href='../people/marlon-brando.html'>Marlon Brando</a></li><li><a class='sidebar-link' href='../people/nelson-mandela.html'>Nelson Mandela</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="postgresql-cheatsheet"><a href="#postgresql-cheatsheet" class="header-anchor">#</a> PostgreSQL cheatsheet</h1> <p>Useful cheatsheet for PostgreSQL</p> <h2 id="upgrading"><a href="#upgrading" class="header-anchor">#</a> Upgrading</h2> <p>Updating a running server (from 10 to 11):</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> postgres-11 <span class="token comment"># Install the latest version, which will start on port 5433</span>
<span class="token function">sudo</span> pg_dropcluster <span class="token number">11</span> main <span class="token parameter variable">--stop</span> <span class="token comment"># Stop the instance on port 5433</span>
<span class="token function">sudo</span> pg_upgradecluster <span class="token number">10</span> main  <span class="token comment"># Upgrade the instance on port 5432</span>
<span class="token function">sudo</span> pg_dropcluster <span class="token number">10</span> main  <span class="token comment"># Drop the outdated instance</span>
</code></pre></div><h2 id="testing"><a href="#testing" class="header-anchor">#</a> Testing</h2> <h4 id="query-performance"><a href="#query-performance" class="header-anchor">#</a> Query performance</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> <span class="token keyword">function</span> perf_query<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">returns</span> void
<span class="token keyword">language</span> <span class="token keyword">sql</span> stable
<span class="token keyword">as</span> $$
  <span class="token keyword">select</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
$$<span class="token punctuation">;</span>

<span class="token keyword">explain</span> <span class="token keyword">analyze</span>
<span class="token keyword">select</span> perf_query<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> generate_series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
&quot;Function Scan on generate_series  (cost=0.00..100.00 rows=10000 width=1) (actual time=10.781..17.027 rows=1000 loops=1)&quot;
&quot;Planning Time: 4.880 ms&quot;
&quot;Execution Time: 23.155 ms&quot;
*/</span>
</code></pre></div><h2 id="templates"><a href="#templates" class="header-anchor">#</a> Templates</h2> <h3 id="new-tables"><a href="#new-tables" class="header-anchor">#</a> New tables</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">public</span><span class="token punctuation">.</span>table_name <span class="token punctuation">(</span>
  id <span class="token keyword">bigint</span> GENERATED <span class="token keyword">BY</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">AS</span> <span class="token keyword">IDENTITY</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  <span class="token keyword">data</span> jsonb<span class="token punctuation">,</span>
  inserted_at <span class="token keyword">timestamp</span> without <span class="token keyword">time</span> zone <span class="token keyword">DEFAULT</span> timezone<span class="token punctuation">(</span><span class="token string">'utc'</span>::<span class="token keyword">text</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  updated_at <span class="token keyword">timestamp</span> without <span class="token keyword">time</span> zone <span class="token keyword">DEFAULT</span> timezone<span class="token punctuation">(</span><span class="token string">'uc'</span>::<span class="token keyword">text</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> <span class="token keyword">public</span><span class="token punctuation">.</span>table_name <span class="token operator">IS</span> <span class="token string">'Some table name.'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>table_name<span class="token punctuation">.</span>inserted_at <span class="token operator">IS</span> <span class="token string">'UTC timestamp of when the record was inserted.'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>table_name<span class="token punctuation">.</span>updated_at <span class="token operator">IS</span> <span class="token string">'UTC timestamp of when the record was last updated.'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="utilities"><a href="#utilities" class="header-anchor">#</a> Utilities</h2> <ul><li><a href="https://stackoverflow.com/questions/17989355/alter-column-ignoring-dependent-views" target="_blank" rel="noopener noreferrer">Updating tables with dependent views<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Usage exanple:<div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> deps_save_and_drop_dependencies<span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> deps_restore_dependencies<span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">,</span> <span class="token string">'users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="using-dblink-in-postgres"><a href="#using-dblink-in-postgres" class="header-anchor">#</a> Using <code>dblink</code> in Postgres</h2> <p><code>dblink</code> is a Postgres extension for querying remote databases. It's simpler than Foreign Data Wrappers (FDWs) for certain tasks.</p> <p><code>dblink</code> in Postgres connects to a different Postgres database or another connection within the same database. It allows querying data from the external source as if it were part of the local database.</p> <p>For example:</p> <div class="language- extra-class"><pre class="language-text"><code>-- enable the extension
CREATE EXTENSION dblink;

-- query remote database  
SELECT *
FROM dblink(
	'host=remotehost user=remoteuser password=remotepassword dbname=remotedb',
	'SELECT id, name FROM remote_table'
) AS remote_data(id INTEGER, name TEXT);
</code></pre></div><h3 id="dblink-vs-fdw"><a href="#dblink-vs-fdw" class="header-anchor">#</a> dblink vs FDW</h3> <p>Foreign Data Wrappers (FDWs) were introduced in Postgres to provide a more standardized and integrated way of accessing external data sources, addressing limitations and expanding capabilities beyond what <code>dblink</code> offers:</p> <ol><li><strong>Standardized Framework</strong>: FDWs are based on the SQL/MED (SQL Management of External Data) standard, providing a standardized approach to handling external data.</li> <li><strong>Broader Data Source Support</strong>: FDWs can connect to a wide variety of data sources, not just Postgres databases. This includes other SQL databases, NoSQL databases, flat files, and web services.</li> <li><strong>Integration with Local Queries</strong>: FDWs allow external data to be queried as if it were part of the local database, offering seamless integration. This includes the ability to join local and remote data.</li> <li><strong>Performance Optimization</strong>: FDWs can push down query operations to the external source, improving performance by reducing the amount of data transferred and leveraging the source's own query capabilities.</li> <li><strong>Scalability</strong>: FDWs are more scalable for systems integrating multiple and diverse data sources.</li> <li><strong>Modular Architecture</strong>: Each FDW is a separate extension, allowing for a modular architecture where only the required FDWs are installed.</li> <li><strong>Enhanced Functionality</strong>: FDWs often provide additional functionalities like write support, transaction management, and advanced authentication mechanisms.</li></ol> <p><code>dblink</code> is better than FDW in these scenarios:</p> <ol><li><strong>Ad-Hoc Queries</strong>: For one-time or infrequent queries to remote databases where setting up an FDW is not justified.</li> <li><strong>Simple Setup</strong>: When you need a quick solution without the overhead of configuring an FDW.</li> <li><strong>Specific Database Tasks</strong>: Useful for database maintenance tasks like cross-database data comparisons or migrations.</li> <li><strong>Limited Access</strong>: When you have limited permissions and can't create foreign servers or tables.</li> <li><strong>Temporary Connections</strong>: For temporary or test environments where a permanent link is unnecessary.</li> <li><strong>Postgres-Specific Features</strong>: When leveraging specific Postgres features or extensions not supported or accessible via FDW.</li></ol> <h3 id="mechanics"><a href="#mechanics" class="header-anchor">#</a> Mechanics</h3> <p>The underlying mechanics of <code>dblink</code> in Postgres involve several key components:</p> <ol><li><strong>Connection Handling</strong>:
<ul><li><code>dblink</code> establishes a connection to a remote Postgres database using a connection string.</li> <li>The connection string includes credentials and details like host, database name, user, and password.</li></ul></li> <li><strong>Query Execution</strong>:
<ul><li>Once connected, <code>dblink</code> executes the SQL query provided in its function call against the remote database.</li> <li>It acts like a client to the remote database, sending the SQL command and waiting for the result.</li></ul></li> <li><strong>Data Transfer</strong>:
<ul><li>After the remote database executes the query, <code>dblink</code> retrieves the result set.</li> <li>The data is transferred over the network from the remote server to the local server where <code>dblink</code> is run.</li></ul></li> <li><strong>Result Representation</strong>:
<ul><li>The results are represented in a format defined in the <code>dblink</code> function call, typically as a set of rows with specified column types.</li> <li>This format allows the data to be treated as if it were from a local table or query.</li></ul></li> <li><strong>Connection Management</strong>:
<ul><li><code>dblink</code> handles the opening and closing of the database connection.</li> <li>Persistent connections can be created for reuse, or one-time connections can be established for ad-hoc queries.</li></ul></li> <li><strong>Error Handling</strong>:
<ul><li><code>dblink</code> includes error handling for issues like connection failures, authentication errors, or SQL execution errors on the remote server.</li></ul></li> <li><strong>Security</strong>:
<ul><li>Security in <code>dblink</code> involves managing credentials securely and ensuring that SQL injection vulnerabilities are mitigated.</li> <li>Proper role and permission management are crucial to ensure secure and controlled access to remote data.</li></ul></li></ol> <p><code>dblink</code> acts as an intermediary, allowing a local Postgres database to execute queries on a remote database and retrieve results, managing connections, data transfer, and security considerations.</p> <h3 id="limitations"><a href="#limitations" class="header-anchor">#</a> Limitations</h3> <p><code>dblink</code> in Postgres doesn't have a hardcoded limit on the amount of data it can receive, but there are practical limitations:</p> <ol><li><strong>Network Bandwidth and Latency</strong>: Large data transfers can be slow, depending on network bandwidth and latency.</li> <li><strong>Memory Usage</strong>: Large result sets consume significant memory on both the client and server side, which can impact performance.</li> <li><strong>Query Performance</strong>: The performance of the remote database can be a bottleneck, especially for complex queries or large datasets.</li> <li><strong>Timeouts</strong>: Network or server timeouts may interrupt large data transfers.</li> <li><strong>Transaction Management</strong>: Large transactions might lead to issues like lock contention or long rollback times in case of failures.</li></ol> <p>To handle large data sets efficiently, it's better to optimise queries, use batching, or incrementally transfer data.</p> <h2 id="postgres-resources"><a href="#postgres-resources" class="header-anchor">#</a> Postgres Resources</h2> <p>Hacker News</p> <ul><li><a href="https://hn.premii.com/#/comments/21484215" target="_blank" rel="noopener noreferrer">System design hack: Postgres is a great pub/sub &amp; job server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://news.ycombinator.com/item?id=22331188" target="_blank" rel="noopener noreferrer">Designing the most performant Row Level Security schema<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://news.ycombinator.com/item?id=22139975" target="_blank" rel="noopener noreferrer">Postgresqlco.nf: PostgreSQL Configuration for Humans<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://hn.premii.com/#/comments/21642340" target="_blank" rel="noopener noreferrer">Pgsh – branch Postgres like Git<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://news.ycombinator.com/item?id=21464272" target="_blank" rel="noopener noreferrer">Postgres Health Check and SQL Performance Analysis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://news.ycombinator.com/item?id=21371642" target="_blank" rel="noopener noreferrer">pg_flame – flamegraph visualizations of PostgreSQL query plans<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.craigkerstiens.com/2013/01/10/more-on-postgres-performance/" target="_blank" rel="noopener noreferrer">More on Postgres Performance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/ric2b/Highly-Available-PostgreSQL-Database" target="_blank" rel="noopener noreferrer">Highly Available PostgreSQL Database<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://news.ycombinator.com/item?id=20343919" target="_blank" rel="noopener noreferrer">A user interface for Postgres EXPLAIN that also gives tips<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yetog/yetog/knowledge-base/edit/main/tech/postgresql.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/8/2024, 8:03:12 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a class='prev' href='mental-models.html'>
        Mental Models
      </a></span> <span class="next"><a href='postgres-data.html'>
        Loading JSON into Postgres
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="../assets/js/app.js" defer></script><script src="../assets/js/vendor.js" defer></script><script src="https://zaylegend.com/assets/js/83.e722bf65.js" defer></script>
  </body>

</html>
