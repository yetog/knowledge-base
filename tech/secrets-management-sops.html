<!DOCTYPE html>
<html lang="en-US">
  
<!-- Mirrored from paul.copplest.one/knowledge/tech/secrets-management-sops by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 25 Jul 2025 01:10:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Secrets management - SOPS | Isayah Young Burke</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="How to use Mozilla SOPS for encrypting sensitive files in your git repository.">
    
    <link rel="preload" href="../assets/css/styles.css" as="style"><link rel="preload" href="../assets/js/app.js" as="script"><link rel="preload" href="../assets/js/vendor.js" as="script"><link rel="preload" href="https://zaylegend.com/assets/js/85.28f50940.js" as="script"><link rel="preload" href="https://zaylegend.com/assets/js/8.9fa57ec5.js" as="script"><link rel="prefetch" href="https://zaylegend.com/assets/js/10.ecb4aeeb.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/11.1cca5831.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/12.7b79cca9.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/13.dd35798e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/14.216f2375.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/15.76312eb5.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/16.46ae3a41.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/17.f7b08d61.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/18.dd33750e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/19.f64a7265.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/20.babf360f.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/21.e2503054.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/22.17537c93.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/23.79b2ac99.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/24.b97db607.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/25.a9e8a358.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/26.8e08adc5.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/27.edd2f913.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/28.691f6bf9.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/29.49c3431f.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/3.450f35a3.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/30.a232bb82.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/31.8c696542.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/32.c9fa23f8.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/33.8d8f26d6.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/34.9b0240fb.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/35.57f7fff7.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/36.007b0846.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/37.4712a913.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/38.047ae1e6.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/39.b70787ca.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/4.55c6a11e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/40.e56466c4.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/41.26e2630e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/42.ebfc62d1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/43.3c2d7a5e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/44.392fcaba.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/45.039d9812.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/46.db45e55e.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/47.96f5c16a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/48.f022a16f.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/49.fc458b57.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/5.3e80985b.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/50.a9d9b467.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/51.7af4f65a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/52.5de2b44d.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/53.39742fa8.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/54.fd653217.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/55.065024be.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/56.aeb89b2a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/57.5a859f32.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/58.74831ded.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/59.f96dffab.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/6.2a6dbaf7.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/60.950b04ed.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/61.fc7c628c.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/62.01f29eea.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/63.24b3adfd.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/64.dfcf9b15.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/65.e197b51a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/66.fadde5b0.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/67.d9d7cbaf.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/68.e3304da2.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/69.57965b45.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/7.d1aa2f1c.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/70.bf37e9a8.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/71.fdd554eb.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/72.8c427b8c.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/73.f739c7ae.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/74.d2305510.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/75.9dd7a327.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/76.cf0b2767.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/77.4c395fa6.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/78.def79530.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/79.2ae40e11.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/80.7c36c3a1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/81.12abf8da.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/82.3da8caa4.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/83.e722bf65.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/84.8d2883f1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/86.70601b86.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/87.d07525a0.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/88.f8e0b95a.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/89.f3b11bd0.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/9.fe7ded09.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/90.a85b4b17.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/91.bb030ac1.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/92.458c9816.js"><link rel="prefetch" href="https://zaylegend.com/assets/js/93.ef320c02.js">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/custom.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="https://zaylegend.com/" class="home-link router-link-active"><!----> <span class="site-name">Isayah Young Burke</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://zaylegend.com/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="../index.html" class="nav-link router-link-active">
  Knowledge
</a></div><div class="nav-item"><a href="https://zaylegend.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Subscribe
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/zaylegend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://zaylegend.com/blog/" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="../index.html" class="nav-link router-link-active">
  Knowledge
</a></div><div class="nav-item"><a href="https://zaylegend.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Subscribe
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/zaylegend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../chess.html'>Chess</a></li><li><a class='sidebar-link' href='../climbing.html'>Climbing</a></li><li><a class='sidebar-link' href='../consciousness.html'>Consciousness</a></li><li><a class='sidebar-link' href='../languages.html'>Languages</a></li><li><a class='sidebar-link' href='../mathematics.html'>Mathematics</a></li><li><a class='sidebar-link' href='../meditation.html'>Meditation</a></li><li><a class='sidebar-link' href='../mimetic-theory.html'>Mimetic Theory</a></li><li><a class='sidebar-link' href='../music.html'>Music</a></li><li><a class='sidebar-link' href='../physics.html'>Physics</a></li><li><a class='sidebar-link' href='../public-speaking.html'>Public Speaking</a></li><li><a class='sidebar-link' href='../pyrolysis.html'>Pyrolysis</a></li><li><a class='sidebar-link' href='../relationships.html'>Relationships</a></li><li><a class='sidebar-link' href='../soil.html'>Soil Health</a></li><li><a class='sidebar-link' href='../space.html'>Space</a></li><li><a class='sidebar-link' href='../trees.html'>Trees</a></li><li><a class='sidebar-link' href='../writing.html'>Writing</a></li><li><a class='sidebar-link' href='../zoology.html'>Zoology</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Tech</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='awesome-list.html'>Awesome List</a></li><li><a class='sidebar-link' href='bash-profile.html'>MacOS Bash Profile</a></li><li><a class='sidebar-link' href='docker.html'>Docker Cheatsheet</a></li><li><a class='sidebar-link' href='html-cheatsheet.html'>HTML Cheatsheet</a></li><li><a class='sidebar-link' href='macos-tips.html'>MacOS tips</a></li><li><a class='sidebar-link' href='mental-models.html'>Mental Models</a></li><li><a class='sidebar-link' href='postgresql.html'>PostgreSQL cheatsheet</a></li><li><a class='sidebar-link' href='postgres-data.html'>Loading JSON into Postgres</a></li><li><a class='sidebar-link' href='regex.html'>Regex Cheatsheet</a></li><li><a aria-current='page' class='active sidebar-link' href='secrets-management-sops.html'>Secrets management - SOPS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a class='sidebar-link' href='secrets-management-sops.html#why'>Why?</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='secrets-management-sops.html#how-sops-works'>How SOPS works</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='secrets-management-sops.html#preparing-our-repository'>Preparing our repository</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='secrets-management-sops.html#preparing-for-encryption-decryption'>Preparing for encryption/decryption</a></li><li class="sidebar-sub-header"><a class='sidebar-link' href='secrets-management-sops.html#encrypting'>Encrypting</a></li></ul></li><li><a class='sidebar-link' href='seo.html'>SEO Cheatsheet</a></li><li><a class='sidebar-link' href='today-i-learned.html'>Today I Learned</a></li><li><a class='sidebar-link' href='vscode-snippets.html'>VSCode Snippets</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Business</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../business/hiring.html'>Hiring</a></li><li><a class='sidebar-link' href='../business/management.html'>Management</a></li><li><a class='sidebar-link' href='../business/sales.html'>Sales</a></li><li><a class='sidebar-link' href='../business/marketing.html'>Marketing</a></li><li><a class='sidebar-link' href='../business/fundraising.html'>Fundraising</a></li><li><a class='sidebar-link' href='../business/resources.html'>Startup Resources</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Levels</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../levels/business.html'>Business</a></li><li><a class='sidebar-link' href='../levels/life.html'>Life</a></li><li><a class='sidebar-link' href='../levels/leadership.html'>Leadership</a></li><li><a class='sidebar-link' href='../levels/learning.html'>Learning</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Philosophy</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../philosophy/ethics.html'>Ethics</a></li><li><a class='sidebar-link' href='../philosophy/buddhism.html'>Buddhism</a></li><li><a class='sidebar-link' href='../philosophy/stoicism.html'>Stoicism</a></li><li><a class='sidebar-link' href='../philosophy/desire.html'>Desire</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>People</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a class='sidebar-link' href='../people.html'>People</a></li><li><a class='sidebar-link' href='../people/lee-kuan-yew.html'>Lee Kuan Yew</a></li><li><a class='sidebar-link' href='../people/jensen-huang.html'>Jensen Huang</a></li><li><a class='sidebar-link' href='../people/elon-musk.html'>Elon Musk</a></li><li><a class='sidebar-link' href='../people/marlon-brando.html'>Marlon Brando</a></li><li><a class='sidebar-link' href='../people/nelson-mandela.html'>Nelson Mandela</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="secrets-management-sops"><a href="#secrets-management-sops" class="header-anchor">#</a> Secrets management - SOPS</h1> <p>Want to store your sensitive secrets in your git repository? Use Mozilla <a href="https://github.com/mozilla/sops" target="_blank" rel="noopener noreferrer">SOPS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>This article will explain how to use Mozilla SOPS for encrypting sensitive files in your git repository.</p> <p>We can use SOPS to encrypt <code>YAML</code>, <code>JSON</code>, <code>ENV</code>, <code>INI</code> and even <code>BINARY</code> files.</p> <p><strong>Contents</strong></p> <ul><li><a href="#why">Why?</a></li> <li><a href="#how-sops-works">How SOPS works</a></li> <li><a href="#preparing-our-repository">Preparing our repository</a></li> <li><a href="#preparing-for-encryptiondecryption">Preparing for encryption/decryption</a> <ul><li><a href="#installing-sops">Installing SOPs</a></li> <li><a href="#preparing-our-repo-for-sops">Preparing our repo for SOPs</a></li> <li><a href="#getting-an-aws-key">Getting an AWS Key</a></li> <li><a href="#getting-a-gcp-key">Getting a GCP Key</a></li></ul></li> <li><a href="#encrypting">Encrypting</a></li></ul> <h2 id="why"><a href="#why" class="header-anchor">#</a> Why?</h2> <p>Let's say we have a <code>.env</code> file in our repository which has sensitive data inside it. Because of the sensitive data, we add it to our <code>.gitignore</code>. However now we have a problem. None of our changes to <code>.env</code> will be saved in git and shared with our team.</p> <p>Ideally we want this versioned in git, so we can resolve any merge conflicts and keep a history of the changes.</p> <p>So let's see how we would do this using SOPS.</p> <h2 id="how-sops-works"><a href="#how-sops-works" class="header-anchor">#</a> How SOPS works</h2> <p>An example of how SOPS would work with AWS. In this case a Key has been set up already in AWS KMS and the developer has been given access to the Key. The developer knows the ID of the key (ARN). The ARN can be shared freely with all your developers because knowing the ARN doesn't grant them access, it explicitly needs to be granted to the developer (on AWS console or using the CLI).</p> <div class="mermaid">
sequenceDiagram
    Developer-&gt;&gt;SOPS: Request to decrypt file using AWS Key ID (ARN)
    SOPS--&gt;&gt;Developer: Get Developer AWS credentials
    SOPS--&gt;&gt;AWS: Checks Developer access to AWS Key
    AWS--&gt;&gt;SOPS: Approves access
    SOPS-&gt;&gt;Developer: Decrypts file
</div> <p>If ever we want to revoke access for a developer, then we can just remove the developer's permissions in AWS KMS, and the developer would no longer be able to decrypt the file:</p> <div class="mermaid">
sequenceDiagram
    Developer-&gt;&gt;SOPS: Request to decrypt file using AWS Key ID (ARN)
    SOPS--&gt;&gt;Developer: Get Developer AWS credentials
    SOPS--&gt;&gt;AWS: Checks Developer access to AWS Key
    AWS--&gt;&gt;SOPS: Denies access
    SOPS--xDeveloper: ERROR
</div> <h2 id="preparing-our-repository"><a href="#preparing-our-repository" class="header-anchor">#</a> Preparing our repository</h2> <p>I'm going to start with a fictional NodeJS repo with the following structure</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># Initial repository</span>
├── .env
├── .gitignore
└── package.json
</code></pre></div><p>Our <code>.env</code> file might have some very sensitive data in it, so we want to make sure it's never checked into git. Make sure to add it to <code>.gitignore</code>!</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># .gitignore</span>
.env
</code></pre></div><p>But we still want to track all the changes in git, so we are instead going to create an encrypted version which can be tracked. Let's first add a couple of commands to our <code>package.json</code>.</p> <div class="language-json5 extra-class"><pre class="language-json5"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;encrypt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sops -e .env &gt; .enc.env&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;decrypt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sops -d .enc.env &gt; .env&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>These commands won't work just yet, but to describe them:</p> <ul><li><strong>npm run encrypt</strong><br>This will encrypt the <code>.env</code> file and save it as <code>.enc.env</code></li> <li><strong>npm run decrypt</strong><br>This will decrypt the <code>.enc.env</code> file and overwrite the contents of <code>.env</code></li></ul> <p>If you aren't using Node then you can just call <code>sops -e .env &gt; .enc.env</code> and <code>sops -d .enc.env &gt; .env</code> directly. These commands are just for convenience so that we don't have to remember the commands everytime we want to use SOPS.</p> <p>Great, we are set up for SOPS, but before we can use SOPS we need to let it know how to encrypt and decrypt our files.</p> <h2 id="preparing-for-encryption-decryption"><a href="#preparing-for-encryption-decryption" class="header-anchor">#</a> Preparing for encryption/decryption</h2> <h3 id="installing-sops"><a href="#installing-sops" class="header-anchor">#</a> Installing SOPs</h3> <p>Before you start you will need to install SOPs on your computer:</p> <div class="language- extra-class"><pre class="language-text"><code>brew install sops
</code></pre></div><h3 id="preparing-our-repo-for-sops"><a href="#preparing-our-repo-for-sops" class="header-anchor">#</a> Preparing our repo for SOPs</h3> <p>In the root of your repo create a file called <code>.sops.yaml</code>, and paste the following contents:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># .sops.yaml</span>
creation_rules:
  - kms: <span class="token string">'FULL_ARN,ANOTHER_FULL_ARN'</span>
    gcp_kms: <span class="token string">'FULL_RESOURCE_ID,ANOTHER_RESOURCE_ID'</span>
    <span class="token comment"># azure_kv: 'FULL_AZURE_CLIENT_ID'</span>
    <span class="token comment"># pgp: 'YOUR_PGP_FINGERPRINT_WITHOUT_SPACES'</span>
</code></pre></div><p>A couple of notes:</p> <p><strong>Different key providers</strong></p> <p>As you can see we are going to need to get an AWS Key and a GCP Key. We could choose just one, but having both when you set up would make life easier if you want to move from one cloud provider to another. Don't worry too much though, it's easy to add one later. You also have an option to use Azure and/or PGP. These two are great options but I want to keep this article simple.</p> <p><strong>Different keys for different paths</strong></p> <p>We could also do something like this in our <code>.sops.yaml</code> file:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># .sops.yaml</span>
creation_rules:
  <span class="token comment"># Here is an example of how to use one set of keys </span>
  <span class="token comment"># upon creation of a file that matches the pattern ./secrets/dev.*</span>
  - path_regex: .*/secrets/dev.*
    kms: <span class="token string">'FULL_ARN,ANOTHER_FULL_ARN'</span>

  <span class="token comment"># Here is an example of how to use a different set of keys </span>
  <span class="token comment"># upon creation of a file that matches the pattern ./secrets/prod.*</span>
  - path_regex: .*/secrets/prod.*
    kms: <span class="token string">'FULL_ARN,ANOTHER_FULL_ARN'</span>

</code></pre></div><h3 id="getting-an-aws-key"><a href="#getting-an-aws-key" class="header-anchor">#</a> Getting an AWS Key</h3> <ul><li>Login to AWS Console</li> <li>Go to KMS</li> <li>Create a new key (name it conveniently)</li> <li>Create another key for safety</li> <li>Grab the ARN's</li></ul> <p>KMS keys stored inside a chip inside a security hardware module. Nobody can access this. We will create IAM roles later which have access to use this key</p> <h3 id="getting-a-gcp-key"><a href="#getting-a-gcp-key" class="header-anchor">#</a> Getting a GCP Key</h3> <p>You may need to enable CLI:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>gcloud auth application-default login
</code></pre></div><p>From CLI</p> <p>gcloud kms keyrings create sops --location global
gcloud kms keys create sops-key --location global --keyring sops --purpose encryption
gcloud kms keys list --location global --keyring sops</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># you should see</span>
NAME                                                                   PURPOSE          PRIMARY_STATE
projects/my-project/locations/global/keyRings/sops/cryptoKeys/sops-key ENCRYPT_DECRYPT  ENABLED
</code></pre></div><ul><li>go to project</li> <li>Search for KMS &gt; Cryptographic keys</li> <li>Create a new keyring</li> <li>Create a new key ('inside' the keyring) - symmetric encrypt/decrypt</li> <li>Dropdown menu &gt; Copy resource ID</li></ul> <h2 id="encrypting"><a href="#encrypting" class="header-anchor">#</a> Encrypting</h2> <p>Any time we make changes to <code>.env</code> we just need to call</p> <div class="language- extra-class"><pre class="language-text"><code>npm run encrypt
</code></pre></div><p>We</p> <div class="language-sh extra-class"><pre class="language-sh"><code>sops ./secrets/dev.env 
<span class="token comment"># or </span>
sops ./secrets/dev.yaml 
<span class="token comment"># or </span>
sops ./secrets/dev.json 

<span class="token comment"># OR</span>

sops <span class="token parameter variable">-e</span> .env <span class="token operator">&gt;</span> .env.enc
sops <span class="token parameter variable">-e</span> ./secrets/dev.env <span class="token operator">&gt;</span> ./secrets/dev2.env
sops <span class="token parameter variable">-d</span> ./secrets/dev2.env <span class="token operator">&gt;</span> .env
</code></pre></div><p>This may take a while because it needs to reach out to AWS and to GCP.</p> <p>Make all changes then hit <code>esc</code> and type <code>:wq</code> to write/save the file.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yetog/yetog/knowledge-base/edit/main/tech/secrets-management-sops.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/16/2020, 7:40:08 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a class='prev' href='regex.html'>
        Regex Cheatsheet
      </a></span> <span class="next"><a href='seo.html'>
        SEO Cheatsheet
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="../assets/js/app.js" defer></script><script src="../assets/js/vendor.js" defer></script><script src="https://zaylegend.com/assets/js/85.28f50940.js" defer></script><script src="https://zaylegend.com/assets/js/8.9fa57ec5.js" defer></script>
  </body>

<!-- Mirrored from paul.copplest.one/knowledge/tech/secrets-management-sops by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 25 Jul 2025 01:10:08 GMT -->
</html>
